<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandarin-Taking-Notes-API</title>
    <link rel="stylesheet" href="styles.css" </head>

<body>
    <h1>Mandarin Notes Taking App</h1>
    <div class="container">

        <section class="notes-input-section">
            <h2>Enter your notes here:</h2>
            <input id="pinyin" placeholder="Pinyin">
            <input id="hanzi" placeholder="汉字">
            <input id="english" placeholder="English meaning">
            <input id="malay" placeholder="Malay meaning">
            <button onclick="saveNote()">Save Note</button>
        </section>

        <section class="notes-display-section">
            <h2>See your current notes here:</h2>
            <button onclick="showNotes()">Get your notes</button>
            <div id="notes-display-container"></div>
        </section>
    </div>

    <script>

        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        async function saveNote() {
            const note = {
                pinyin: document.getElementById("pinyin").value,
                hanzi: document.getElementById("hanzi").value,
                english: document.getElementById("english").value,
                malay: document.getElementById("malay").value
            };

            try {
                const res = await fetch("http://127.0.0.1:8000/add-note", {
                    method: "POST",
                    headers: myHeaders,
                    body: JSON.stringify(note)
                });
                if (!res.ok) {
                    throw new Error(`Response status: ${response.status}`);
                }

                const data = await res.json();
                console.log(data);
                alert("Saved!");
            } catch (error) {
                console.error(error.message);
            }
        }

        async function showNotes() {
            try {
                const res = await fetch("http://127.0.0.1:8000/notes/json", {
                    method: "GET",
                    headers: myHeaders,
                });
                if (!res.ok) {
                    throw new Error(`Response status: ${response.status}`);
                }

                const notes = await res.json();

                displayNoteContainer = document.getElementById("notes-display-container");
                displayNoteContainer.innerHTML = notes.map(n => `
                    <table class="note">
                        <thead>
                            <tr>
                                <th><b>Pinyin:</b> ${n.pinyin}</th>
                                <th><b>汉字:</b> ${n.hanzi}</th>
                                <th><b>English:</b> ${n.english}</th>
                                <th><b>Malay:</b> ${n.malay}</th>
                            </tr>
                        </thead>
                        <tbody>
                    </table>
                `).join("");

            } catch (error) {
                console.error(error.message)
                displayNote.innerHTML = "There seems to be issue loading your notes. Please try again later.";
            }
        }
    </script>
</body>

</html>